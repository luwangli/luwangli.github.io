## 进程管理

进程A调动进程B的过程：

进程A->内核提供的系统调用

进程如何产生操作系统的调用

![image-20200610192753966](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200610192753966.png)

### 1.1 当只有进程A时，操作系统内存布局如下：

![image-20200610194724122](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200610194724122.png)

###　１.２　进程Ａ调用操作系统

进程通过软中断soft interrupt，比如int80

![image-20200610195451739](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200610195451739.png)

glibc中的fork函数为了调用kernel，需要先修改寄存器，然后使用中断

![image-20200610195939128](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200610195939128.png)

### 异常和中断处理

同步异常，因为异常都是由于CPU处理到异常的指令造成的，与CPU同步。操作系统启动的时候，会将异常向量表（vector table）加载到内存中，如果操作系统遇到不会处理的指令，回去向量表中查找。

![image-20200610200320638](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200610200320638.png)

上一节中的glib库的fork函数，通过int 0x80引起中断，80表示这个中断是系统调用，接着内核使用syscall handler 来捕捉，并在syscall table找到第二个（eax寄存器指定）操作，sys_fork()函数

![image-20200610202125020](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200610202125020.png)

![image-20200610202749569](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200610202749569.png)

操作系统不是一个会执行的程序，进程A进入到内核态时，上下文【context】不会变化

![image-20200610203753492](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200610203753492.png)

### 程序和进程的区别

程序是静态的文件，通常格式为ELF（可执行文件，executable file），保存在磁盘；进程存在在内存中，并已经执行。

> 程序是一组指令的有序集合，是静态的实体。而进程是程序在某个数据集的执行。进程和程序并非一一对应的关系，一个程序执行在不同的数据集就成为不同的进程。

进程 =  程序 + 数据

![image-20200610204513973](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200610204513973.png)

### 1.3 fork过程

每个进程在kernel中都会存储一个结构保存重要信息，如PID等。进程A fork进程B的过程中，会直接复制进程A的结构，然后修改这个结构，比如PID。如下图，

![image-20200610210720634](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200610210720634.png)

进程描述符【结构】如下图所示，在linux中的形式

![image-20200610211001999](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200610211001999.png)

进程的状态变化图

![image-20200610211938233](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200610211938233.png)